<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd"
       default-autowire="no">

    <cache:annotation-driven />

    <bean class="com.tui.fly.cli.AirportsCommand">
        <constructor-arg ref="airports"/>
    </bean>

    <bean class="com.tui.fly.cli.ConnectionsCommand">
        <constructor-arg ref="airports"/>
        <constructor-arg ref="flights"/>
    </bean>

    <bean class="com.tui.fly.cli.DestinationsCommand">
        <constructor-arg ref="airports"/>
        <constructor-arg ref="flights"/>
    </bean>

    <bean class="com.tui.fly.Application"/>
    
    <bean id="conversionService" class="org.springframework.context.support.ConversionServiceFactoryBean">
        <property name="converters">
            <set>
                <bean class="com.tui.fly.domain.ConnectionToStringConverter"/>
            </set>
        </property>
    </bean>

    <bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager">
        <constructor-arg ref="ehCacheManager"/>
    </bean>

    <bean id="ehCacheManager" class="net.sf.ehcache.CacheManager" factory-method="newInstance"/>

    <beans profile="memory">

        <bean id="airports" class="com.tui.fly.service.InMemoryAirportRegistry"/>

        <bean id="flights" class="com.tui.fly.service.InMemoryFlightCatalog"/>

        <bean id="airportData" class="org.springframework.core.io.ClassPathResource">
            <constructor-arg value="airports.csv"/>
        </bean>

        <bean id="flightData" class="org.springframework.core.io.ClassPathResource">
            <constructor-arg value="flights.csv"/>
        </bean>

    </beans>

    <beans profile="relational">

        <bean id="database" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
            <property name="driverClass" value="org.hsqldb.jdbc.JDBCDriver"/>
            <property name="url" value="jdbc:hsqldb:mem:mymemdb"/>
            <property name="username" value="SA"/>
            <property name="password" value=""/>
        </bean>

        <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
            <constructor-arg ref="database"/>
        </bean>

        <bean id="jdbc" class="org.springframework.jdbc.core.JdbcTemplate">
            <constructor-arg ref="database"/>
        </bean>

        <bean id="airports" class="com.tui.fly.service.DatabaseAirportRegistry"/>

        <bean id="flights" class="com.tui.fly.service.DatabaseFlightCatalog"/>

        <bean id="liquibase" class="liquibase.integration.spring.SpringLiquibase">
            <property name="dataSource" ref="database"/>
            <property name="changeLog" value="classpath:liquibase.xml"/>
        </bean>

    </beans>

</beans>
